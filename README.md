# ESP32 智能时钟

这是一个基于 ESP32-S3 的智能时钟项目，集成了多种功能，包括时间显示、温湿度监测、WiFi连接、MQTT控制等功能。

## 硬件要求

- ESP32-S3 开发板
- ST7789 1.3寸 240x240 显示屏
- FT6236 触摸控制器
- SHT31 温湿度传感器
- GPIO 控制接口

## 引脚连接

### I2C 接口
- SDA: GPIO3
- SCL: GPIO2

### GPIO 控制接口
- GPIO0: 通用输入输出
- GPIO1: 通用输入输出
- GPIO2: 通用输入输出
- GPIO3: PWM亮度控制
### ESP32S3
- I2C SDA: GPIO3
- I2C SCL: GPIO2

#### TFT SPI接口 (ESP32S3)
#define TFT_SCLK 10
#define TFT_MOSI 11
#define TFT_RST  14  // Reset pin (could connect to RST pin)
#define TFT_DC   8  // Data Command control pin
#define TFT_CS   9  // Chip select control pin
## 功能特点

1. **时间显示**
   - 支持24小时制和12小时制切换（双击时间进行切换）
   - 显示日期信息
   - 自动NTP时间同步

2. **温湿度显示**
   - 实时显示环境温度
   - 实时显示环境湿度
   - 每5秒自动更新一次

3. **WiFi功能**
   - 支持WiFi配网
   - 显示WiFi连接状态
   - WiFi信号强度显示
   - 支持WiFi扫描

4. **MQTT控制**
   - 支持MQTT服务器配置
   - GPIO远程控制
   - 亮度远程调节
   - 实时状态反馈

5. **页面导航**
   - 支持左右滑动切换页面
   - 页面切换动画效果
   - 直观的导航提示

## 使用说明

### 首次使用

1. 给设备上电，等待启动完成
2. 设备会自动创建名为"SmartClockAP"的WiFi热点
3. 使用手机或电脑连接该热点
4. 在弹出的配置页面中：
   - 选择并配置要连接的WiFi网络
   - 配置MQTT服务器信息（如需要）
   - 设置MQTT主题前缀（默认为"smartclock/"）
5. 保存配置后设备将自动重启并连接到配置的网络

### 页面操作

1. **主页面**
   - 显示时间、日期、温湿度信息
   - 双击时间可切换12/24小时制
   - 左右滑动可切换到其他页面

2. **WiFi信息页面**
   - 显示当前WiFi连接状态
   - 显示IP地址、信号强度等信息
   - 左右滑动切换页面

3. **GPIO控制页面**
   - 显示GPIO引脚状态
   - 可通过触摸切换GPIO状态
   - 左右滑动切换页面

4. **WiFi扫描页面**
   - 点击"SCAN"按钮扫描周围WiFi网络
   - 显示网络名称、信号强度和加密状态
   - 点击"RESET"按钮可重置WiFi配置
   - 左右滑动切换页面

5. **MQTT控制页面**
   - 显示MQTT连接状态
   - GPIO开关控制
   - 亮度滑动调节
   - 点击"Config"按钮可重新配置MQTT
   - 左右滑动切换页面

### MQTT主题说明

设备会订阅以下主题（假设主题前缀为"smartclock/"）：

- `smartclock/gpio0` - GPIO0控制（发送"0"或"1"）
- `smartclock/gpio1` - GPIO1控制（发送"0"或"1"）
- `smartclock/gpio2` - GPIO2控制（发送"0"或"1"）
- `smartclock/brightness` - 亮度控制（发送0-255的数值）

设备状态变化时也会向这些主题发布最新状态。

## 故障排除

1. **设备无法连接WiFi**
   - 检查WiFi密码是否正确
   - 确认WiFi信号强度是否足够
   - 使用RESET按钮重置WiFi配置

2. **显示屏无显示**
   - 检查电源连接
   - 确认显示屏连接线是否正确
   - 检查亮度设置

3. **触摸不响应**
   - 检查I2C连接是否正确
   - 确认触摸屏是否正确初始化
   - 重启设备尝试恢复

4. **温湿度显示异常**
   - 检查SHT31传感器连接
   - 确认I2C地址设置是否正确
   - 等待传感器预热（约2分钟）

5. **MQTT连接失败**
   - 检查MQTT服务器地址和端口
   - 确认用户名密码是否正确
   - 检查网络连接状态

## 注意事项

1. 首次使用需要进行WiFi配网
2. 建议使用5V-2A电源供电
3. 避免将设备放置在高温潮湿环境
4. 定期检查固件更新
5. 建议定期备份MQTT配置信息

## 技术支持

如果您在使用过程中遇到任何问题，请参考以上故障排除指南。如果问题仍然存在，可以：

1. 检查串口调试信息
2. 查看设备运行日志
3. 联系技术支持

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。 